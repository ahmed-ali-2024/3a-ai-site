---
import { getCollection, type CollectionEntry } from "astro:content";
import MainLayout from "../../layouts/blog/MainLayout.astro";
import OptimizedImage from "../../components/blog/OptimizedImage.astro";

export async function getStaticPaths() {
    const services = await getCollection("services");
    const publishedServices = services.filter((s) => !s.data.draft);

    return publishedServices.map((service) => ({
        params: { slug: service.slug },
        props: { service },
    }));
}

interface Props {
    service: CollectionEntry<"services">;
}

const { service } = Astro.props;
const { Content } = await service.render();

// Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø®Ø¯Ù…Ø§Øª Ø£Ø®Ø±Ù‰ Ù„Ù„Ø¹Ø±Ø¶
const allServices = await getCollection("services");
const otherServices = allServices
    .filter((s) => !s.data.draft && s.slug !== service.slug)
    .slice(0, 3);
---

<MainLayout
    title={service.data.title}
    description={service.data.description}
    image={service.data.image}
>
    <article class="service-detail">
        <div class="container">
            {
                service.data.image && (
                    <div class="hero-image">
                        <OptimizedImage
                            src={service.data.image}
                            alt={service.data.title}
                            loading="eager"
                            width={1200}
                            height={500}
                            widths={[600, 900, 1200]}
                            sizes="100vw"
                        />
                    </div>
                )
            }

            <header class="service-header">
                <h1>{service.data.title}</h1>
                <p class="description">{service.data.description}</p>
            </header>

            {
                service.data.features && service.data.features.length > 0 && (
                    <section class="features-section">
                        <h2>Ù…Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø©</h2>
                        <ul class="features-list">
                            {service.data.features.map((feature) => (
                                <li>{feature}</li>
                            ))}
                        </ul>
                    </section>
                )
            }

            <section class="content-section">
                <Content />
            </section>

            <div class="cta-section">
                <h3>Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ø§Ø³ØªÙØ§Ø¯Ø© Ù…Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø¯Ù…Ø©ØŸ</h3>
                <a href="/blog/Contact" class="cta-button">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a>
            </div>

            {
                otherServices.length > 0 && (
                    <section class="other-services">
                        <h2>Ø®Ø¯Ù…Ø§Øª Ø£Ø®Ø±Ù‰</h2>
                        <div class="services-grid">
                            {otherServices.map((s) => (
                                <a
                                    href={`/services/${s.slug}`}
                                    class="mini-service-card"
                                >
                                    <span class="icon">
                                        {s.data.icon || "ğŸ”§"}
                                    </span>
                                    <h4>{s.data.title}</h4>
                                </a>
                            ))}
                        </div>
                    </section>
                )
            }
        </div>
    </article>
</MainLayout>

<style>
    .service-detail {
        padding: 2rem 0;
    }

    .hero-image {
        margin-bottom: 2rem;
        border-radius: var(--radius-xl);
        overflow: hidden;
    }

    .hero-image img,
    .hero-image :global(img) {
        width: 100%;
        max-height: 400px;
        object-fit: contain;
        background: var(--color-surface);
    }

    .service-header {
        text-align: center;
        padding: 2rem 0;
        margin-bottom: 2rem;
        border-bottom: 1px solid var(--color-border);
    }

    .service-header h1 {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        color: var(--color-text);
    }

    .description {
        font-size: 1.25rem;
        color: var(--color-text-secondary);
        max-width: 700px;
        margin: 0 auto;
        line-height: 1.7;
    }

    .features-section {
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        padding: 2rem;
        margin-bottom: 2rem;
    }

    .features-section h2 {
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
        color: var(--color-text);
    }

    .features-list {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 1rem;
        list-style: none;
        padding: 0;
    }

    .features-list li {
        padding: 1rem;
        padding-right: 2.5rem;
        position: relative;
        background: var(--color-surface-hover);
        border-radius: var(--radius-md);
    }

    .features-list li::before {
        content: "âœ“";
        position: absolute;
        right: 1rem;
        color: var(--color-primary);
        font-weight: bold;
    }

    .content-section {
        font-size: 1.1rem;
        line-height: 1.8;
        color: var(--color-text);
        margin-bottom: 3rem;
    }

    .content-section :global(h2) {
        font-size: 1.75rem;
        margin: 2rem 0 1rem;
    }

    .content-section :global(h3) {
        font-size: 1.4rem;
        margin: 1.5rem 0 0.75rem;
    }

    .content-section :global(p) {
        margin-bottom: 1.25rem;
    }

    .content-section :global(ul),
    .content-section :global(ol) {
        padding-right: 1.5rem;
        margin-bottom: 1.25rem;
    }

    .cta-section {
        text-align: center;
        padding: 3rem;
        background: linear-gradient(
            135deg,
            rgba(59, 130, 246, 0.1),
            rgba(147, 51, 234, 0.1)
        );
        border-radius: var(--radius-xl);
        margin-bottom: 3rem;
    }

    .cta-section h3 {
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
        color: var(--color-text);
    }

    .cta-button {
        display: inline-block;
        padding: 1rem 2.5rem;
        background: linear-gradient(135deg, var(--color-primary), #a855f7);
        color: white;
        font-weight: 600;
        border-radius: var(--radius-lg);
        text-decoration: none;
        transition: all 0.3s;
    }

    .cta-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
    }

    .other-services {
        padding-top: 2rem;
        border-top: 1px solid var(--color-border);
    }

    .other-services h2 {
        font-size: 1.5rem;
        margin-bottom: 1.5rem;
        color: var(--color-text);
    }

    .services-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 1rem;
    }

    .mini-service-card {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem 1.5rem;
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: var(--radius-lg);
        text-decoration: none;
        transition: all 0.2s;
    }

    .mini-service-card:hover {
        border-color: var(--color-primary);
        transform: translateY(-2px);
    }

    .mini-service-card .icon {
        font-size: 1.5rem;
    }

    .mini-service-card h4 {
        color: var(--color-text);
        font-size: 1rem;
        margin: 0;
    }

    @media (max-width: 768px) {
        .service-header h1 {
            font-size: 2rem;
        }

        .features-list {
            grid-template-columns: 1fr;
        }

        .services-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
